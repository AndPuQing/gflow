<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>gbatch Reference - gflow Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A lightweight, single-node job scheduler inspired by Slurm">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">gflow Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="gbatch-command-reference"><a class="header" href="#gbatch-command-reference">gbatch Command Reference</a></h1>
<p>Complete reference for the <code>gbatch</code> command - gflow's job submission tool.</p>
<h2 id="synopsis"><a class="header" href="#synopsis">Synopsis</a></h2>
<pre><code class="language-bash">gbatch [OPTIONS] [COMMAND...]
gbatch [OPTIONS] [SCRIPT]
gbatch new &lt;NAME&gt;
</code></pre>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p><code>gbatch</code> submits jobs to the gflow scheduler. It supports both script-based and direct command execution using positional arguments, with extensive options for resource allocation, scheduling, and job dependencies.</p>
<h2 id="modes"><a class="header" href="#modes">Modes</a></h2>
<h3 id="script-submission"><a class="header" href="#script-submission">Script Submission</a></h3>
<p>Submit a script file:</p>
<pre><code class="language-bash">gbatch [OPTIONS] &lt;SCRIPT&gt;
</code></pre>
<p>The script can contain <code># GFLOW</code> directives for job parameters.</p>
<h3 id="direct-command"><a class="header" href="#direct-command">Direct Command</a></h3>
<p>Execute a command directly using positional arguments:</p>
<pre><code class="language-bash">gbatch [OPTIONS] &lt;COMMAND&gt; [ARGS...]
</code></pre>
<p>The command and its arguments come after all options. Command-line options take precedence over script directives.</p>
<h3 id="template-creation"><a class="header" href="#template-creation">Template Creation</a></h3>
<p>Create a new job script template:</p>
<pre><code class="language-bash">gbatch new &lt;NAME&gt;
</code></pre>
<p>Creates <code>&lt;NAME&gt;.sh</code> with a template structure.</p>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<h3 id="job-submission"><a class="header" href="#job-submission">Job Submission</a></h3>
<h4 id="script"><a class="header" href="#script"><code>&lt;SCRIPT&gt;</code></a></h4>
<p>Path to script file to execute.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">gbatch my_job.sh
gbatch ./scripts/train.sh
gbatch /absolute/path/to/job.sh
</code></pre>
<p><strong>Requirements</strong>:</p>
<ul>
<li>File must exist</li>
<li>Should be executable (<code>chmod +x</code>)</li>
<li>Can contain <code># GFLOW</code> directives</li>
</ul>
<p><strong>Mutually exclusive</strong> with direct command execution.</p>
<h4 id="direct-command-execution"><a class="header" href="#direct-command-execution">Direct Command Execution</a></h4>
<p>When no script is provided, all arguments after the options are treated as the command to execute.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">gbatch python train.py
gbatch echo 'Hello'; sleep 10
gbatch nvidia-smi
</code></pre>
<p><strong>Notes</strong>:</p>
<ul>
<li>Executed in bash shell</li>
<li>Can contain multiple commands (use <code>;</code> or <code>&amp;&amp;</code>)</li>
<li>Mutually exclusive with <code>&lt;SCRIPT&gt;</code></li>
<li>Commands with complex arguments should be quoted appropriately</li>
</ul>
<h3 id="resource-allocation"><a class="header" href="#resource-allocation">Resource Allocation</a></h3>
<h4 id="--gpus-n--g-n"><a class="header" href="#--gpus-n--g-n"><code>--gpus &lt;N&gt;</code>, <code>-g &lt;N&gt;</code></a></h4>
<p>Number of GPUs to request.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Request 1 GPU
gbatch --gpus 1 python train.py

# Request 2 GPUs
gbatch -g 2 python multi_gpu_train.py

# No GPU (default)
gbatch python cpu_task.py
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Default: 0 (no GPU)</li>
<li>Sets <code>CUDA_VISIBLE_DEVICES</code> automatically</li>
<li>Job waits if insufficient GPUs available</li>
<li>See <a href="../user-guide/gpu-management.html">GPU Management</a></li>
</ul>
<h4 id="--conda-env-env"><a class="header" href="#--conda-env-env"><code>--conda-env &lt;ENV&gt;</code></a></h4>
<p>Conda environment to activate.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">gbatch --conda-env myenv python script.py
gbatch --conda-env pytorch_env my_training.sh
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Runs <code>conda activate &lt;ENV&gt;</code> before job</li>
<li>Requires conda to be initialized in shell</li>
<li>Job fails if environment doesn't exist</li>
</ul>
<p><strong>Auto-detection</strong> (for direct command mode only):</p>
<ul>
<li>If <code>--conda-env</code> is not specified, gflow automatically detects your currently active conda environment</li>
<li>Uses the <code>CONDA_DEFAULT_ENV</code> environment variable</li>
<li>Only applies when using direct command execution, not when submitting scripts</li>
<li>Explicit <code>--conda-env</code> always takes precedence over auto-detection</li>
</ul>
<pre><code class="language-bash"># With auto-detection (uses currently active conda env)
conda activate myenv
gbatch python script.py  # Will use 'myenv'

# Explicit override (ignores active env)
conda activate myenv
gbatch --conda-env otherenv python script.py  # Uses 'otherenv'

# No conda environment
conda deactivate
gbatch python script.py  # No conda activation
</code></pre>
<h3 id="scheduling-options"><a class="header" href="#scheduling-options">Scheduling Options</a></h3>
<h4 id="--priority-n"><a class="header" href="#--priority-n"><code>--priority &lt;N&gt;</code></a></h4>
<p>Job priority (0-255, default: 10).</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># High priority (runs first)
gbatch --priority 100 python urgent.py

# Default priority
gbatch python normal.py  # priority = 10

# Low priority (runs last)
gbatch --priority 1 python background.py
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Higher values = higher priority</li>
<li>Jobs with higher priority start first when resources free</li>
<li>Doesn't preempt running jobs</li>
</ul>
<h4 id="--depends-on-id"><a class="header" href="#--depends-on-id"><code>--depends-on &lt;ID&gt;</code></a></h4>
<p>Job ID this job depends on. Supports shorthand for recent submissions.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Job 1
gbatch python preprocess.py
# Returns job ID 1

# Job 2 (depends on 1)
gbatch --depends-on 1 python train.py

# Equivalent shorthand using the last submission
gbatch --depends-on @ python train.py

# Two submissions back
gbatch --depends-on @~2 python evaluate.py
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Job waits for dependency to reach <code>Finished</code> state</li>
<li>If dependency fails, this job never starts</li>
<li>Only one dependency per job supported</li>
<li>See <a href="../user-guide/job-dependencies.html">Job Dependencies</a></li>
<li>Shorthand values resolve to the most recent job IDs recorded by <code>gbatch</code></li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li>Dependency job must exist</li>
<li>No circular dependencies allowed</li>
<li>Cannot depend on self</li>
<li><code>@~N</code> requires at least <code>N</code> previous submissions</li>
</ul>
<h4 id="--time-time--t-time"><a class="header" href="#--time-time--t-time"><code>--time &lt;TIME&gt;</code>, <code>-t &lt;TIME&gt;</code></a></h4>
<p>Maximum job runtime (time limit).</p>
<p><strong>Formats</strong>:</p>
<ul>
<li><code>MM</code>: Minutes only (e.g., <code>30</code> = 30 minutes)</li>
<li><code>MM:SS</code>: Minutes and seconds (e.g., <code>5:30</code> = 5min 30sec)</li>
<li><code>HH:MM:SS</code>: Hours, minutes, seconds (e.g., <code>2:00:00</code> = 2 hours)</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># 30 minutes
gbatch --time 30 python quick.py

# 2 hours
gbatch --time 2:00:00 python train.py

# 5 minutes 30 seconds
gbatch -t 5:30 python test.py
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Job terminated if exceeds limit</li>
<li>Graceful termination (SIGINT/Ctrl-C)</li>
<li>State changes to <code>Timeout</code></li>
<li>See <a href="../user-guide/time-limits.html">Time Limits</a></li>
</ul>
<h4 id="--array-spec"><a class="header" href="#--array-spec"><code>--array &lt;SPEC&gt;</code></a></h4>
<p>Create job array.</p>
<p><strong>Format</strong>: <code>START-END</code> (e.g., <code>1-10</code>)</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Create 10 jobs (tasks 1-10)
gbatch --array 1-10 python process.py --task $GFLOW_ARRAY_TASK_ID

# Create 5 jobs with GPUs
gbatch --array 1-5 --gpus 1 python train.py --fold $GFLOW_ARRAY_TASK_ID
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Creates multiple independent jobs</li>
<li>Each job gets unique <code>$GFLOW_ARRAY_TASK_ID</code></li>
<li>All jobs share same resource requirements</li>
<li>Useful for parameter sweeps</li>
</ul>
<p><strong>Environment variable</strong>:</p>
<ul>
<li><code>GFLOW_ARRAY_TASK_ID</code>: Task number (1, 2, 3, ...)</li>
<li>Set to 0 for non-array jobs</li>
</ul>
<h4 id="--name-name"><a class="header" href="#--name-name"><code>--name &lt;NAME&gt;</code></a></h4>
<p>Custom job name.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">gbatch --name "my-training-run" python train.py
gbatch --name "experiment-1" my_job.sh
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Default: Auto-generated name (e.g., "silent-pump-6338")</li>
<li>Used as tmux session name</li>
<li>Helps identify jobs in queue</li>
<li>Must be unique (or gflow appends suffix)</li>
</ul>
<h3 id="global-options"><a class="header" href="#global-options">Global Options</a></h3>
<h4 id="--config-path"><a class="header" href="#--config-path"><code>--config &lt;PATH&gt;</code></a></h4>
<p>Use custom configuration file (hidden option).</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">gbatch --config /path/to/custom.toml your_command
</code></pre>
<h4 id="--help--h"><a class="header" href="#--help--h"><code>--help</code>, <code>-h</code></a></h4>
<p>Display help message.</p>
<pre><code class="language-bash">$ gbatch --help
Submits jobs to the gflow scheduler. Inspired by sbatch.

Usage: gbatch [OPTIONS] &lt;SCRIPT_OR_COMMAND&gt;... [COMMAND]

Commands:
  new   Create a new job script template
  help  Print this message or the help of the given subcommand(s)

Arguments:
  &lt;SCRIPT_OR_COMMAND&gt;...  The script or command to run (e.g., "script.sh" or "python train.py --epochs 100") If a single argument that exists as a file, it's treated as a script. Otherwise, all arguments are joined as a command

Options:
  -c, --conda-env &lt;CONDA_ENV&gt;    The conda environment to use
  -g, --gpus &lt;NUMS&gt;              The GPU count to request
      --priority &lt;PRIORITY&gt;      The priority of the job
      --depends-on &lt;DEPENDS_ON&gt;  The ID of the job this job depends on
      --array &lt;ARRAY&gt;            The job array specification (e.g., "1-10")
  -t, --time &lt;TIME&gt;              Time limit for the job (formats: "HH:MM:SS", "MM:SS", "MM", or seconds as number)
  -h, --help                     Print help
  -V, --version                  Print version
</code></pre>
<h4 id="--version--v"><a class="header" href="#--version--v"><code>--version</code>, <code>-V</code></a></h4>
<p>Display version information.</p>
<pre><code class="language-bash">$ gbatch --version
gbatch 0.3.14 (2025-10-31T07:56:04.036593510Z)
Branch: main
Commit: ca405086be69e9efa97b13daf61c1ed8a12f98ed
Authors: PuQing &lt;me@puqing.work&gt;
</code></pre>
<h2 id="script-directives"><a class="header" href="#script-directives">Script Directives</a></h2>
<p>Embed job parameters in script using <code># GFLOW</code> comments.</p>
<h3 id="syntax"><a class="header" href="#syntax">Syntax</a></h3>
<pre><code class="language-bash">#!/bin/bash
# GFLOW --option value
# GFLOW --another-option value

# Your commands here
</code></pre>
<h3 id="supported-directives"><a class="header" href="#supported-directives">Supported Directives</a></h3>
<pre><code class="language-bash"># GFLOW --gpus &lt;N&gt;
# GFLOW --time &lt;TIME&gt;
# GFLOW --priority &lt;N&gt;
# GFLOW --conda-env &lt;ENV&gt;
# GFLOW --depends-on &lt;ID&gt;
</code></pre>
<h3 id="example-script"><a class="header" href="#example-script">Example Script</a></h3>
<pre><code class="language-bash">#!/bin/bash
# GFLOW --gpus 1
# GFLOW --time 2:00:00
# GFLOW --priority 20
# GFLOW --conda-env pytorch

echo "Starting training at $(date)"
python train.py --epochs 100
echo "Training complete at $(date)"
</code></pre>
<h3 id="precedence"><a class="header" href="#precedence">Precedence</a></h3>
<p>Command-line options override script directives:</p>
<pre><code class="language-bash"># Script has: # GFLOW --time 1:00:00
# CLI overrides it:
gbatch --time 2:00:00 my_script.sh  # Uses 2 hours, not 1
</code></pre>
<h2 id="template-creation-1"><a class="header" href="#template-creation-1">Template Creation</a></h2>
<h3 id="new-subcommand"><a class="header" href="#new-subcommand"><code>new</code> Subcommand</a></h3>
<pre><code class="language-bash">gbatch new &lt;NAME&gt;
</code></pre>
<p>Creates <code>&lt;NAME&gt;.sh</code> with template structure.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">$ gbatch new my_job
Created template: my_job.sh

$ cat my_job.sh
#!/bin/bash
# GFLOW --gpus 0
# GFLOW --time 1:00:00
# GFLOW --priority 10

# Your commands here
echo "Job started at $(date)"

# Add your actual commands
# python script.py

echo "Job finished at $(date)"
</code></pre>
<p><strong>Usage</strong>:</p>
<ol>
<li>Create template: <code>gbatch new my_job</code></li>
<li>Edit script: <code>vim my_job.sh</code></li>
<li>Make executable: <code>chmod +x my_job.sh</code></li>
<li>Submit: <code>gbatch my_job.sh</code></li>
</ol>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<p>gflow sets these variables in your job:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th><th>Example</th></tr></thead><tbody>
<tr><td><code>CUDA_VISIBLE_DEVICES</code></td><td>Allocated GPU IDs</td><td><code>0,1</code></td></tr>
<tr><td><code>GFLOW_ARRAY_TASK_ID</code></td><td>Array task ID (0 if not array)</td><td><code>5</code></td></tr>
</tbody></table>
</div>
<p><strong>Usage in scripts</strong>:</p>
<pre><code class="language-bash">#!/bin/bash
echo "GPUs: $CUDA_VISIBLE_DEVICES"
echo "Task: $GFLOW_ARRAY_TASK_ID"
python train.py
</code></pre>
<h2 id="output"><a class="header" href="#output">Output</a></h2>
<h3 id="submission-success"><a class="header" href="#submission-success">Submission Success</a></h3>
<pre><code class="language-bash">$ gbatch python train.py
Submitted batch job 42 (silent-pump-6338)
</code></pre>
<p><strong>Format</strong>: <code>Submitted batch job &lt;ID&gt; (&lt;NAME&gt;)</code></p>
<h3 id="job-logs"><a class="header" href="#job-logs">Job Logs</a></h3>
<p>Output captured to: <code>~/.local/share/gflow/logs/&lt;JOBID&gt;.log</code></p>
<p><strong>View logs</strong>:</p>
<pre><code class="language-bash"># View completed job
cat ~/.local/share/gflow/logs/42.log

# Follow running job
tail -f ~/.local/share/gflow/logs/42.log
</code></pre>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="basic-submission"><a class="header" href="#basic-submission">Basic Submission</a></h3>
<pre><code class="language-bash"># Direct command
gbatch echo 'Hello, gflow!'

# Script file
gbatch my_script.sh

# With options
gbatch --gpus 1 --time 2:00:00 python train.py
</code></pre>
<h3 id="resource-allocation-1"><a class="header" href="#resource-allocation-1">Resource Allocation</a></h3>
<pre><code class="language-bash"># GPU job
gbatch --gpus 2 python multi_gpu_train.py

# CPU job with time limit
gbatch --time 30 python preprocess.py

# Conda environment (explicit)
gbatch --conda-env myenv python script.py

# Conda environment (auto-detected from currently active env)
conda activate myenv
gbatch python script.py  # Automatically uses 'myenv'
</code></pre>
<h3 id="job-dependencies"><a class="header" href="#job-dependencies">Job Dependencies</a></h3>
<pre><code class="language-bash"># Sequential pipeline
ID1=$(gbatch --time 30 python prep.py | grep -oP '\d+')
ID2=$(gbatch --depends-on $ID1 --gpus 1 python train.py | grep -oP '\d+')
gbatch --depends-on $ID2 python eval.py
</code></pre>
<h3 id="job-arrays"><a class="header" href="#job-arrays">Job Arrays</a></h3>
<pre><code class="language-bash"># Process 10 tasks in parallel
gbatch --array 1-10 python process.py --id $GFLOW_ARRAY_TASK_ID

# GPU sweep
gbatch --array 1-5 --gpus 1 --time 4:00:00 \
       python train.py --lr $(echo "0.001 0.01 0.1 0.5 1.0" | cut -d" " -f$GFLOW_ARRAY_TASK_ID)
</code></pre>
<h3 id="priority-and-scheduling"><a class="header" href="#priority-and-scheduling">Priority and Scheduling</a></h3>
<pre><code class="language-bash"># Urgent job
gbatch --priority 100 --gpus 1 python urgent.py

# Background job
gbatch --priority 1 python background.py

# Named job
gbatch --name "exp-baseline" python train_baseline.py
</code></pre>
<h3 id="script-templates"><a class="header" href="#script-templates">Script Templates</a></h3>
<pre><code class="language-bash"># Create template
gbatch new experiment

# Edit it
vim experiment.sh

# Submit it
gbatch experiment.sh
</code></pre>
<h2 id="validation-and-errors"><a class="header" href="#validation-and-errors">Validation and Errors</a></h2>
<h3 id="common-errors"><a class="header" href="#common-errors">Common Errors</a></h3>
<pre><code class="language-bash"># Both script and command
Error: Cannot specify both script and direct command

# Script not found
Error: Script file not found: missing.sh

# Invalid dependency
Error: Dependency job 999 not found

# Circular dependency
Error: Circular dependency detected

# Invalid time format
Error: Invalid time format. Use HH:MM:SS, MM:SS, or MM

# Conda env not found
Error: Conda environment 'invalid_env' not found
</code></pre>
<h3 id="validation-checks"><a class="header" href="#validation-checks">Validation Checks</a></h3>
<p>At submission, gbatch validates:</p>
<ul>
<li>✅ Script exists (if using script mode)</li>
<li>✅ Dependency job exists</li>
<li>✅ No circular dependencies</li>
<li>✅ Valid time format</li>
<li>✅ Not both script and direct command</li>
<li>✅ GPU count is reasonable</li>
</ul>
<h2 id="integration-examples"><a class="header" href="#integration-examples">Integration Examples</a></h2>
<h3 id="shell-script-batch-submission"><a class="header" href="#shell-script-batch-submission">Shell Script: Batch Submission</a></h3>
<pre><code class="language-bash">#!/bin/bash
# submit_experiments.sh - Submit multiple experiments

for lr in 0.001 0.01 0.1; do
    for bs in 32 64 128; do
        gbatch --gpus 1 --time 4:00:00 \
               --name "lr${lr}_bs${bs}" \
               python train.py --lr $lr --batch-size $bs
    done
done
</code></pre>
<h3 id="shell-script-pipeline-submission"><a class="header" href="#shell-script-pipeline-submission">Shell Script: Pipeline Submission</a></h3>
<pre><code class="language-bash">#!/bin/bash
# submit_pipeline.sh - Submit data processing pipeline

set -e

echo "Submitting pipeline..."

# Stage 1: Download
ID1=$(gbatch --time 1:00:00 --name "download" \
             python download.py | grep -oP '\d+')
echo "Job $ID1 (download) submitted"

# Stage 2: Process (depends on download)
ID2=$(gbatch --depends-on $ID1 --time 2:00:00 --name "process" \
             python process.py | grep -oP '\d+')
echo "Job $ID2 (process) submitted"

# Stage 3: Train (depends on process)
ID3=$(gbatch --depends-on $ID2 --gpus 1 --time 8:00:00 --name "train" \
             python train.py | grep -oP '\d+')
echo "Job $ID3 (train) submitted"

echo "Pipeline submitted! Monitor with: watch gqueue -t"
</code></pre>
<h3 id="python-script-job-submission"><a class="header" href="#python-script-job-submission">Python Script: Job Submission</a></h3>
<pre><code class="language-python">#!/usr/bin/env python3
# submit_jobs.py - Submit jobs from Python

import subprocess
import re

def submit_job(command, **kwargs):
    """Submit a job and return its ID."""
    cmd = ['gbatch']

    # Add options first
    if 'gpus' in kwargs:
        cmd += ['--gpus', str(kwargs['gpus'])]
    if 'time' in kwargs:
        cmd += ['--time', kwargs['time']]
    if 'priority' in kwargs:
        cmd += ['--priority', str(kwargs['priority'])]
    if 'depends_on' in kwargs:
        cmd += ['--depends-on', str(kwargs['depends_on'])]
    if 'name' in kwargs:
        cmd += ['--name', kwargs['name']]

    # Add command at the end
    cmd += command.split() if isinstance(command, str) else command

    result = subprocess.run(cmd, capture_output=True, text=True)
    match = re.search(r'job (\d+)', result.stdout)
    return int(match.group(1)) if match else None

# Submit pipeline
prep_id = submit_job('python preprocess.py', time='30', name='prep')
train_id = submit_job('python train.py', gpus=1, time='4:00:00',
                       depends_on=prep_id, name='train')
eval_id = submit_job('python evaluate.py', time='10',
                      depends_on=train_id, name='eval')

print(f"Pipeline: {prep_id} -&gt; {train_id} -&gt; {eval_id}")
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ol>
<li>
<p><strong>Always set time limits</strong> for production jobs</p>
<pre><code class="language-bash">gbatch --time 2:00:00 your_command
</code></pre>
</li>
<li>
<p><strong>Use meaningful names</strong> for easier tracking</p>
<pre><code class="language-bash">gbatch --name "exp-baseline-lr0.01" your_command
</code></pre>
</li>
<li>
<p><strong>Test scripts locally</strong> before submitting</p>
<pre><code class="language-bash">bash my_job.sh  # Test first
gbatch my_job.sh  # Then submit
</code></pre>
</li>
<li>
<p><strong>Request only needed GPUs</strong></p>
<pre><code class="language-bash">gbatch --gpus 1 "..."  # Not --gpus 4 if you only need 1
</code></pre>
</li>
<li>
<p><strong>Use dependencies</strong> for workflows</p>
<pre><code class="language-bash">ID=$(gbatch python prep.py | grep -oP '\d+')
gbatch --depends-on $ID python train.py
</code></pre>
</li>
<li>
<p><strong>Use job arrays</strong> for parallel tasks</p>
<pre><code class="language-bash">gbatch --array 1-10 python process.py --id $GFLOW_ARRAY_TASK_ID
</code></pre>
</li>
<li>
<p><strong>Add error handling</strong> in scripts</p>
<pre><code class="language-bash">#!/bin/bash
set -e  # Exit on error
</code></pre>
</li>
<li>
<p><strong>Log important info</strong> in your jobs</p>
<pre><code class="language-bash">echo "Job started: $(date)"
echo "GPUs: $CUDA_VISIBLE_DEVICES"
</code></pre>
</li>
</ol>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="./gqueue-reference.html">gqueue</a> - Job queue reference</li>
<li><a href="./gcancel-reference.html">gcancel</a> - Job cancellation reference</li>
<li><a href="./ginfo-reference.html">ginfo</a> - Scheduler inspection reference</li>
<li><a href="../user-guide/job-submission.html">Job Submission</a> - Detailed submission guide</li>
<li><a href="../user-guide/job-dependencies.html">Job Dependencies</a> - Workflow management</li>
<li><a href="../user-guide/gpu-management.html">GPU Management</a> - GPU allocation guide</li>
<li><a href="../user-guide/time-limits.html">Time Limits</a> - Time limit documentation</li>
<li><a href="./quick-reference.html">Quick Reference</a> - Command cheat sheet</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/quick-reference.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../reference/gqueue-reference.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/quick-reference.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../reference/gqueue-reference.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
